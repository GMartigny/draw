/** Copyright (c) 2017 Guillaume Martigny - MIT License - v0.1.0 */

function Animation(a){this.iteration=0,this.func=a}function Background(a){Utils.assertLength(arguments,1),this.style=a,this.animation=null}function BackgroundImage(a,b){this.image=new Image,this.image.src=a,this.fill=b}function LinearGradient(a,b){isNaN(+a)&&void 0!==LinearGradient.orientation[a]&&(a=LinearGradient.orientation[a]),this.angle=+a||0,this.params=b}function RadialGradient(a,b){Utils.assertLength(arguments,1),a instanceof Shape?this.center=a.position:a instanceof Position&&(this.center=a),this.params=b}function Position(a,b,c){this.x=+a||0,this.y=+b||0,this.origin={x:this.x,y:this.y},this.animation=c||!1,this.linked=[],this.isLinked=!1}function Scene(a,b){Utils.assertLength(arguments,1),this.options=b||{},a.width=this.options.width||window.innerWidth,a.height=this.options.height||window.innerHeight,a.style.width="100%",a.style.height="100%",a.style.display="block",this.context=a.getContext("2d"),this.shapes=[],this.loop=!1}function Shape(a,b){Utils.assertLength(arguments,1),this.position=Position.createFrom(a),this.options=b||{}}function Arc(a,b,c,d,e,f){Utils.assertLength(arguments,2),Shape.call(this,a,f),this.radius=b,this.startAngle=c||0,this.endAngle=d||Utils.PI,this.clockwise=!!e}function Circle(a,b,c){Utils.assertLength(arguments,2),Arc.call(this,a,b,0,2*Utils.PI,!0,c)}function Point(a,b){Utils.assertLength(arguments,1),Shape.call(this,a,b)}function Polygon(a,b){Utils.assertLength(arguments,1),Utils.assertLength(a,1),this.position=new Position,this.options=b||{},this.points=[],this.isLinkedToOthers=!1,this.extremes={minX:null,maxX:null,minY:null,maxY:null};for(var c=0,d=0,e=a.length,f=0;f<e;++f){var g;if(a[f]instanceof Shape?(this.isLinkedToOthers=!0,g=Position.createFrom(a[f])):a[f]instanceof Position&&(g=a[f]),!g)throw new TypeError("Polygon can only link positions or shapes, but "+a[f].constructor.name+" given.");c+=g.getX(),d+=g.getY(),this._saveExtremes(g),this.position.addLink(g),this.points.push(g)}this.position.setOrigin(c/e,d/e)}function Blob(a,b,c){this.tension=b||.5,Polygon.call(this,a,c)}function Line(a,b,c){Utils.assertLength(arguments,2),Polygon.call(this,[a,b],c)}function Rectangle(a,b,c,d){Utils.assertLength(arguments,2),this.startPoint=Position.createFrom(a),this.endPoint=new Position(this.startPoint.getX()+b,this.startPoint.getY()+c),Polygon.call(this,[this.startPoint,this.endPoint],d)}function Square(a,b,c){Utils.assertLength(arguments,2),Rectangle.call(this,a,b,b,c)}function Star(a,b,c,d,e){if(Utils.assertLength(arguments,3),c<3)throw new RangeError("Can't create a star with less than 3 branches, but only "+c+" given.");d=d||.5;for(var f=[],g=2*c,h=0;h<g;++h){var i=(h/g-.25)*Utils.PI*2,j=h%2?b*d:b,k=Position.createFrom(a);k.addX(Utils.cos(i)*j).addY(Utils.sin(i)*j),f.push(k)}Polygon.call(this,f,e)}function Triangle(a,b,c,d){Utils.assertLength(arguments,3),Polygon.call(this,[a,b,c],d)}function Text(a,b,c){Utils.assertLength(arguments,2),this.text=a,Shape.call(this,b,c)}var Utils={PI:Math.PI,abs:Math.abs,sin:Math.sin,cos:Math.cos,max:Math.max,min:Math.min,sq:function(a){return Math.pow(a,2)},sqrt:Math.sqrt,rand:Math.random,floor:function(a){return 0|a},round:function(a){return this.floor(a+.5)},ceil:function(a){return this.floor(a+1)},random:function(a){return this.round(this.rand()*a)},noop:function(){},extends:function(a,b,c){if(b&&(a.prototype=Object.create(b.prototype),a.prototype.constructor=a),c)for(var d in c)c.hasOwnProperty(d)&&(a.prototype[d]&&(a.prototype["_"+d]=a.prototype[d]),a.prototype[d]=c[d])},assertLength:function(a,b){if(a.length<b)throw new TypeError("Awaiting at least "+b+" arguments, only found "+a.length)}};Utils.extends(Animation,null,{run:function(a,b){this.func.call(a,this.iteration++,b)},restart:function(a){this.iteration=0,a.reset()}}),Animation.Swirl=function(a,b,c){return Utils.assertLength(arguments,1),b=b||.1,new Animation(function(d){var e=c?d*b:-d*b;this.setX(this.origin.x+Utils.sin(e)*a),this.setY(this.origin.y+Utils.cos(e)*a)})},Animation.Rotate=function(a,b){return a=a||.1,new Animation(function(c,d){d.translate(this.getX(),this.getY());var e=b?-c*a:c*a;d.rotate(e),d.translate(-this.getX(),-this.getY())})},Animation.Gravity=function(a,b){return b=void 0===b?.3:b,new Animation(function(c,d){a=a||d.canvas.height,this.getY()>=a&&c>0?(this.setY(a),this.animation.iteration=Utils.floor(-c*b)):this.addY(.09*c)})},Utils.extends(Background,null,{getStyle:function(){return this.animation&&this.animation.run(),this.style},animateWith:function(a){this.animation=a},getCSS:function(){return this.getStyle()}}),BackgroundImage.fillType={noRepeat:"no-repeat",repeat:"repeat",repeatX:"repeat-x",repeatY:"repeat-y",stretch:"stretch"},Utils.extends(BackgroundImage,Background,{getStyle:function(a,b){var c=null;return this.image.width&&(c=a.createPattern(this.image,this.fill)),this.style=c,this._getStyle()}}),LinearGradient.orientation={toRight:0,toBottomRight:45,toBottom:90,toBottomLeft:135,toLeft:180,toTopRight:-45,toTop:-90,toTopLeft:-135},Utils.extends(LinearGradient,Background,{getStyle:function(a,b){var c=b.width()/2,d=b.height()/2,e=b.position.getX(),f=b.position.getY(),g=Utils.cos(this.angle*Utils.PI/180),h=Utils.sin(this.angle*Utils.PI/180),i=a.createLinearGradient(e-c*g,f-d*h,e+c*g,f+d*h);for(var j in this.params)this.params.hasOwnProperty(j)&&i.addColorStop(j/100,this.params[j]);return this.style=i,this._getStyle()},getCSS:function(a){var b="linear-gradient("+(this.angle+90)+"deg, ",c=[];for(var d in this.params)this.params.hasOwnProperty(d)&&c.push(this.params[d]+" "+d+"%");return b+=c.join(", ")+")"}}),Utils.extends(RadialGradient,Background,{getRadius:function(a){return Utils.max(a.width(),a.height())/2},getStyle:function(a,b){var c=this.center.getX(),d=this.center.getY(),e=a.createRadialGradient(c,d,0,c,d,this.getRadius(b));for(var f in this.params)this.params.hasOwnProperty(f)&&e.addColorStop(f/100,this.params[f]);return this.style=e,this._getStyle()},getCSS:function(){var a=this.center.getX()+"px ",b=this.center.getY()+"px",c="radial-gradient(circle closest-side at "+a+b+", ",d=[];for(var e in this.params)this.params.hasOwnProperty(e)&&d.push(this.params[e]+" "+e+"%");return c+=d.join(", ")+")"}}),Position.createFrom=function(a){var b;if(a instanceof Shape)b=Position.createFrom(a.position);else{if(!(a instanceof Position))throw new TypeError("First argument should be type Shape or Position, but "+a.constructor.name+" given");b=new Position(a.getX(),a.getY()),a.addLink(b)}return b},Utils.extends(Position,null,{getX:function(){return this.x},getY:function(){return this.y},setX:function(a){return this.setTo(a,this.y)},setY:function(a){return this.setTo(this.x,a)},setTo:function(a,b){var c=(+a||0)-this.x,d=(+b||0)-this.y;return this.addX(c).addY(d)},addX:function(a,b){return this.move(a,0,b)},addY:function(a,b){return this.move(0,a,b)},move:function(a,b,c){return a=+a||0,b=+b||0,0===a&&0===b||(this.x+=a,this.y+=b,c&&(this.origin.x+=a,this.origin.y+=b),this.linked.forEach(function(c){c.move(a,b,!0)})),this},setOrigin:function(a,b){return this.x=a+(this.x-this.origin.x),this.y=b+(this.y-this.origin.y),this.origin.x=a,this.origin.y=b,this},reset:function(){return this.setX(this.origin.x).setY(this.origin.y)},animateWith:function(a){return this.animation=a,this},animate:function(a){return this.animation&&this.animation.run(this,a),this},addLink:function(a){Utils.assertLength(arguments,1),a.isLinked=!0,this.linked.push(a)}}),Utils.extends(Scene,null,{startAnimation:function(){this.loop||(this.loop=!0,this.render())},stopAnimation:function(){this.loop=!1},render:function(){this.loop&&requestAnimationFrame(this.render.bind(this)),this.options.fillColor instanceof Background?this.context.canvas.style.backgroundImage=this.options.fillColor.getCSS(this):"string"==typeof this.options.fillColor&&(this.context.canvas.style.backgroundColor=this.options.fillColor);var a=this.context;a.clearRect(0,0,a.canvas.width,a.canvas.height),this.shapes.forEach(function(b){b.forEach(function(b){b.render(a)})})},add:function(a,b){Utils.assertLength(arguments,1),b=b||0,this.shapes[b]||(this.shapes[b]=[]),this.shapes[b].push(a),a.completeOptions(this.options)},background:function(a){if(!(a instanceof Background||"string"==typeof a))throw new TypeError("Unexpected background type.");this.options.fillColor=a},clear:function(){this.shapes=[]},center:function(){return new Position(Utils.floor(this.width()/2),Utils.floor(this.height()/2))},randomPosition:function(){return new Position(Utils.random(this.width()),Utils.random(this.height()))},width:function(){return this.context.canvas.width},height:function(){return this.context.canvas.height}}),Utils.extends(Shape,null,{render:function(a){a.save(),this.position.animate(a),this.draw(a),a.restore()},draw:function(a){a.beginPath(),this.trace(a),this.fill(a),this.stroke(a),a.closePath(),this.options.debug&&(a.fillStyle="#F33",a.fillRect(this.position.getX()-1,this.position.getY()-1,2,2))},background:function(a){Scene.prototype.background.call(this,a)},fill:function(a){this.options.fillColor&&(this.options.fillColor instanceof Background?a.fillStyle=this.options.fillColor.getStyle(a,this):"string"==typeof this.options.fillColor&&(a.fillStyle=this.options.fillColor),a.fill())},stroke:function(a){this.options.strokeColor&&(a.strokeStyle=this.options.strokeColor,a.lineWidth=this.options.strokeWidth||1,a.stroke())},animateWith:function(a){this.position.animateWith(a)},completeOptions:function(a){for(var b in a)a.hasOwnProperty(b)&&void 0===this.options[b]&&(this.options[b]=a[b])},trace:function(){throw new ReferenceError("Unimplemented function.")},width:function(){throw new ReferenceError("Unimplemented function.")},height:function(){throw new ReferenceError("Unimplemented function.")}}),Utils.extends(Arc,Shape,{trace:function(a){a.arc(this.position.getX(),this.position.getY(),this.radius,this.startAngle,this.endAngle,!this.clockwise)}}),Utils.extends(Circle,Arc,{width:function(){return 2*this.radius},height:function(){return 2*this.radius}}),Utils.extends(Point,Shape,{trace:Utils.noop,stroke:Utils.noop,width:function(){return 0},height:function(){return 0}}),Utils.extends(Polygon,Shape,{_saveExtremes:function(a){var b=a.getX(),c=a.getY();this.extremes.minX=null===this.extremes.minX?b:Utils.min(this.extremes.minX,b),this.extremes.maxX=null===this.extremes.maxX?b:Utils.max(this.extremes.maxX,b),this.extremes.minY=null===this.extremes.minY?c:Utils.min(this.extremes.minY,c),this.extremes.maxY=null===this.extremes.maxY?c:Utils.max(this.extremes.maxY,c)},trace:function(a){var b=this.points[0];a.moveTo(b.getX(),b.getY());for(var c=1,d=this.points.length;c<d;++c){var e=this.points[c];this._saveExtremes(e),a.lineTo(e.getX(),e.getY())}a.lineTo(b.getX(),b.getY())},animateWith:function(a){if(this.isLinkedToOthers)throw new ReferenceError("Can't animate polygon with link to other.");this._animateWith(a)},width:function(){return this.extremes.maxX-this.extremes.minX},height:function(){return this.extremes.maxY-this.extremes.minY}}),Blob._getControlPoints=function(a,b,c,d){var e=a.getX(),f=b.getX(),g=c.getX(),h=a.getY(),i=b.getY(),j=c.getY(),k=Utils.sqrt(Utils.sq(f-e)+Utils.sq(i-h)),l=Utils.sqrt(Utils.sq(g-f)+Utils.sq(j-i)),m=d*k/(k+l),n=d-m;return[f+m*(e-g),i+m*(h-j),f-n*(e-g),i-n*(h-j)]},Utils.extends(Blob,Polygon,{trace:function(a){for(var b=[],c=this.points.length,d=0;d<c;++d)b[(d+1)%c]=Blob._getControlPoints(this.points[d],this.points[(d+1)%c],this.points[(d+2)%c],this.tension);for(a.moveTo(this.points[0].getX(),this.points[0].getY()),d=0;d<c;++d)a.bezierCurveTo(b[d][2],b[d][3],b[(d+1)%c][0],b[(d+1)%c][1],this.points[(d+1)%c].getX(),this.points[(d+1)%c].getY())}}),Utils.extends(Line,Polygon,{fill:Utils.noop,width:function(){return Utils.abs(this.points[0].getX(),this.points[1].getX())},height:function(){return Utils.abs(this.points[0].getY(),this.points[1].getY())}}),Rectangle.fromPointToPoint=function(a,b,c){var d=new Rectangle(a,0,0,c);return d.endPoint=Position.createFrom(b),d.isLinkedToOthers=!0,d},Utils.extends(Rectangle,Polygon,{trace:function(a){a.rect(this.startPoint.getX(),this.startPoint.getY(),this.endPoint.getX()-this.startPoint.getX(),this.endPoint.getY()-this.startPoint.getY())},setWidth:function(a){return this.endPoint.setX(this.startPoint.getX()+a),this},setHeight:function(a){return this.endPoint.setY(this.startPoint.getY()+a),this},width:function(){return Line.prototype.width.call(this)},height:function(){return Line.prototype.height.call(this)}}),Utils.extends(Square,Rectangle),Utils.extends(Star,Polygon,{}),Utils.extends(Triangle,Polygon,{}),Utils.extends(Text,Shape,{trace:function(a){var b=(this.options.bold?"bold ":"")+(this.options.italic?"italic ":"");b+=(this.options.fontSize||10)+"px "+(this.options.font||"sans-serif"),a.font=b,a.textAlign=this.options.align||"left",a.textBaseline=this.options.baseline||"alphabetic"},fill:function(a){this.options.fillColor&&(a.save(),a.fillStyle=this.options.fillColor,a.translate(this.position.getX(),this.position.getY()),a.fillText(this.text,0,0),a.restore())},stroke:function(a){this.options.strokeColor&&(a.save(),a.strokeStyle=this.options.strokeColor,a.lineWidth=this.options.strokeWidth,a.translate(this.position.getX(),this.position.getY()),a.strokeText(this.text,0,0),a.restore())}});